!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).S=e()}(this,function(){"use strict";var n=function n(e,t){null===h&&console.warn("computations created without a root or parent will never be disposed");var l=v(e,t,!1,!1),u=l.node,o=l.value;return null===u?function n(){return o}:function n(){return u.current()}};Object.defineProperty(n,"default",{value:n}),n.root=function n(e){var t,l=h,u=0===e.length?null:function e(){null===n||(null!==f?a.disposes.add(n):A(n))},n=null===u?c:w();h=n;try{t=null===u?e():e(u)}finally{h=l}return null!==u&&$(n,null,void 0,!0)&&(n=null),t},n.on=function e(t,l,u,o){var s;return Array.isArray(t)&&(t=(s=t,function n(){for(var e=0;e<s.length;e++)s[e]()})),o=!!o,n(function e(n){var u=d;return t(),o?o=!1:(d=null,n=l(n),d=u),n},u)},n.effect=function n(e,t){v(e,t,!1,!1)},n.data=function n(e){var l=new t(e);return function n(e){return 0===arguments.length?l.current():l.next(e)}},n.value=function n(e,l){var u=new t(e),o=-1;return function n(t){if(0===arguments.length)return u.current();if(!(l?l(e,t):e===t)){var s=a.time;if(o===s)throw Error("conflicting values: "+t+" is not the same as "+e);o=s,e=t,u.next(t)}return t}},n.freeze=function n(e){var t=void 0;if(null!==f)t=e();else{(f=a).changes.reset();try{t=e(),y()}finally{f=null}}return t},n.sample=function n(e){var t,l=d;return d=null,t=e(),d=l,t},n.cleanup=function n(e){null===h?console.warn("cleanups created without a root or parent will never be run"):null===h.cleanups?h.cleanups=[e]:h.cleanups.push(e)},n.makeDataNode=function n(e){return new t(e)},n.makeComputationNode=v,n.disposeNode=function n(e){null!==f?a.disposes.add(e):A(e)},n.isFrozen=function n(){return null!==f},n.isListening=function n(){return null!==d};var e={time:function(){return a.time}},t=function(){function n(n){this.value=n,this.pending=s,this.log=null}return n.prototype.current=function(){var n;return null!==d&&(n=this,void(null===n.log&&(n.log=new u),_(n.log))),this.value},n.prototype.next=function(n){if(null!==f){if(this.pending!==s){if(n!==this.pending)throw Error("conflicting changes: "+n+" !== "+this.pending)}else this.pending=n,a.changes.add(this)}else null!==this.log?(this.pending=n,a.changes.add(this),y()):this.value=n;return n},n.prototype.clock=function(){return e},n}(),l=function(){function n(){this.fn=null,this.value=void 0,this.age=-1,this.state=i,this.source1=null,this.source1slot=0,this.sources=null,this.sourceslots=null,this.log=null,this.owned=null,this.cleanups=null}return n.prototype.current=function(){if(null!==d){var n;if(this.age===a.time){if(this.state===r)throw Error("circular dependency");N(this)}n=this,null===n.log&&(n.log=new u),_(n.log)}return this.value},n.prototype.clock=function(){return e},n}(),u=function n(){this.node1=null,this.node1slot=0,this.nodes=null,this.nodeslots=null},o=function(){function n(){this.items=[],this.count=0}return n.prototype.reset=function(){this.count=0},n.prototype.add=function(n){this.items[this.count++]=n},n.prototype.run=function(n){for(var e=this.items,t=0;t<this.count;t++)n(e[t]),e[t]=null;this.count=0},n}(),s={},i=0,r=2,c=new l,a=new function n(){this.time=0,this.changes=new o,this.updates=new o,this.disposes=new o},f=null,d=null,h=null,p=null,g={node:null,value:void 0};function v(n,e,t,l){var u=w(),o=h,s=d,i=null===f;h=u,d=l?null:u,e=i?function n(e,t){f=a,a.changes.reset(),a.updates.reset();try{return e(t)}finally{h=d=f=null}}(n,e):n(e),h=o,d=s;var r=$(u,n,e,t);return i&&function n(e,t){if(a.changes.count>0||a.updates.count>0){a.time++;try{m(a)}finally{f=null,h=e,d=t}}}(o,s),g.node=r?null:u,g.value=e,g}function w(){var n=p;return null===n?n=new l:p=null,n}function $(n,e,t,l){var u,o=l||null===h||h===c?null:h,s=null===n.source1&&(null===n.owned&&null===n.cleanups||null!==o);if(s){if(p=n,null!==o){if(null!==n.owned){if(null===o.owned)o.owned=n.owned;else for(u=0;u<n.owned.length;u++)o.owned.push(n.owned[u]);n.owned=null}if(null!==n.cleanups){if(null===o.cleanups)o.cleanups=n.cleanups;else for(u=0;u<n.cleanups.length;u++)o.cleanups.push(n.cleanups[u]);n.cleanups=null}}}else n.fn=e,n.value=t,n.age=a.time,null!==o&&(null===o.owned?o.owned=[n]:o.owned.push(n));return s}function _(n){var e,t=d,l=null===t.source1?-1:null===t.sources?0:t.sources.length;null===n.node1?(n.node1=t,n.node1slot=l,e=-1):null===n.nodes?(n.nodes=[t],n.nodeslots=[l],e=0):(e=n.nodes.length,n.nodes.push(t),n.nodeslots.push(l)),null===t.source1?(t.source1=n,t.source1slot=e):null===t.sources?(t.sources=[n],t.sourceslots=[e]):(t.sources.push(n),t.sourceslots.push(e))}function y(){var n=h;a.updates.reset(),a.time++;try{m(a)}finally{f=d=null,h=n}}function m(n){var e=f,t=0;for(f=n,n.disposes.reset();0!==n.changes.count||0!==n.updates.count||0!==n.disposes.count;)if(t>0&&n.time++,n.changes.run(k),n.updates.run(N),n.disposes.run(A),t++>1e5)throw Error("Runaway clock detected");f=e}function k(n){n.value=n.pending,n.pending=s,n.log&&x(n.log)}function x(n){var e=n.node1,t=n.nodes;if(null!==e&&b(e),null!==t)for(var l=0,u=t.length;l<u;l++)b(t[l])}function b(n){var e=a.time;n.age<e&&(n.age=e,n.state=1,a.updates.add(n),null!==n.owned&&function n(e){for(var t=0;t<e.length;t++){var l=e[t];l.age=a.time,l.state=i,null!==l.owned&&n(l.owned)}}(n.owned),null!==n.log&&x(n.log))}function N(n){if(1===n.state){var e=h,t=d;h=d=n,n.state=r,z(n,!1),n.value=n.fn(n.value),n.state=i,h=e,d=t}}function z(n,e){var t,l,u=n.source1,o=n.sources,s=n.sourceslots,i=n.cleanups,r=n.owned;if(null!==i){for(t=0;t<i.length;t++)i[t](e);n.cleanups=null}if(null!==r){for(t=0;t<r.length;t++)A(r[t]);n.owned=null}if(null!==u&&(j(u,n.source1slot),n.source1=null),null!==o)for(t=0,l=o.length;t<l;t++)j(o.pop(),s.pop())}function j(n,e){var t,l,u=n.nodes,o=n.nodeslots;-1===e?n.node1=null:(t=u.pop(),l=o.pop(),e!==u.length&&(u[e]=t,o[e]=l,-1===l?t.source1slot=e:t.sourceslots[l]=e))}function A(n){n.fn=null,n.log=null,z(n,!0)}return n});
